{% extends "base.html" %}

{% block title %}資産ダッシュボード{% endblock %}

{% block extra_styles %}
<style>
    .header-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 12px 0;
    }
    
    .header-title {
        font-size: 16px;
        font-weight: 600;
        color: #333;
        flex: 1;
        text-align: center;
    }
    
    .icon-btn {
        background: none;
        border: none;
        cursor: pointer;
        padding: 8px;
        color: #333;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .refresh-icon {
        width: 24px;
        height: 24px;
        transition: transform 0.3s ease;
    }
    
    .icon-btn:active .refresh-icon {
        animation: rotate 0.6s ease-in-out;
    }
    
    @keyframes rotate {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
    
    .total-card {
        background: white;
        border-radius: 16px;
        padding: 24px;
        margin-bottom: 24px;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .total-label {
        font-size: 14px;
        color: #666;
        margin-bottom: 8px;
    }
    
    .total-amount {
        font-size: 36px;
        font-weight: 700;
        color: #333;
        margin-bottom: 12px;
        letter-spacing: -0.5px;
    }
    
    .total-profit {
        font-size: 20px;
        font-weight: 600;
        padding: 8px 20px;
        background: #f8f8f8;
        border-radius: 20px;
        display: inline-block;
    }
    
    .profit-plus { color: #dc3545; }
    .profit-minus { color: #28a745; }
    
    .asset-grid {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-bottom: 20px;
    }
    
    .asset-card {
        background: white;
        border-radius: 16px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.15s ease;
        text-decoration: none;
        color: inherit;
        display: block;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
    }
    
    .asset-card:active {
        transform: scale(0.97);
        box-shadow: 0 1px 4px rgba(0,0,0,0.12);
    }
    
    .card-icon {
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-bottom: 12px;
        font-size: 20px;
    }
    
    .card-name {
        font-size: 13px;
        color: #666;
        margin-bottom: 8px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    
    .card-amount {
        font-size: 20px;
        font-weight: 600;
        color: #333;
    }
    
    .card-detail {
        font-size: 11px;
        color: #999;
        margin-top: 4px;
    }
    
    .card-profit {
        font-size: 14px;
        font-weight: 600;
        margin-top: 8px;
    }
    
    @media (min-width: 768px) {
        .asset-grid {
            grid-template-columns: repeat(3, 1fr);
        }
    }
    
    @media (min-width: 1024px) {
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .asset-grid {
            grid-template-columns: repeat(5, 1fr);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="header-bar">
    <form method="post" action="{{ url_for('update_all_prices') }}" style="margin: 0;">
        <button type="submit" class="icon-btn" onclick="return confirm('全ての価格を更新しますか？時間がかかる場合があります。')">
            <svg class="refresh-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="23 4 23 10 17 10"></polyline>
                <polyline points="1 20 1 14 7 14"></polyline>
                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path>
            </svg>
        </button>
    </form>
    <div class="header-title">ようこそ {{ user_name }}さん</div>
    <a href="{{ url_for('logout') }}" class="icon-btn">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <polyline points="16 17 21 12 16 7"></polyline>
            <line x1="21" y1="12" x2="9" y2="12"></line>
        </svg>
    </a>
</div>

<div class="total-card">
    <div class="total-label">総残高</div>
    <div class="total-amount">¥{{ "{:,.0f}".format(total_assets) }}</div>
    <div class="total-profit {% if total_profit >= 0 %}profit-plus{% else %}profit-minus{% endif %}">
        {% if total_profit >= 0 %}+{% endif %}¥{{ "{:,.0f}".format(total_profit) }}
    </div>
</div>

<div class="asset-grid">
    <a href="{{ url_for('manage_assets', asset_type='jp_stock') }}" class="asset-card">
        <div class="card-icon" style="background: #e8f5e9;">📊</div>
        <div class="card-name">日本株</div>
        <div class="card-amount">¥{{ "{:,.0f}".format(jp_total) }}</div>
        <div class="card-detail">{{ jp_stocks|length }} 銘柄</div>
        <div class="card-profit {% if jp_profit >= 0 %}profit-plus{% else %}profit-minus{% endif %}">
            {% if jp_profit >= 0 %}+{% endif %}¥{{ "{:,.0f}".format(jp_profit) }}
        </div>
    </a>
    
    <a href="{{ url_for('manage_assets', asset_type='us_stock') }}" class="asset-card">
        <div class="card-icon" style="background: #e3f2fd;">🇺🇸</div>
        <div class="card-name">米国株</div>
        <div class="card-amount">¥{{ "{:,.0f}".format(us_total_jpy) }}</div>
        <div class="card-detail">${{ "{:,.2f}".format(us_total_usd) }} ({{ us_stocks|length }} 銘柄)</div>
        <div class="card-profit {% if us_profit_jpy >= 0 %}profit-plus{% else %}profit-minus{% endif %}">
            {% if us_profit_jpy >= 0 %}+{% endif %}¥{{ "{:,.0f}".format(us_profit_jpy) }}
        </div>
    </a>
    
    <a href="{{ url_for('manage_assets', asset_type='cash') }}" class="asset-card">
        <div class="card-icon" style="background: #fff3e0;">💰</div>
        <div class="card-name">現金</div>
        <div class="card-amount">¥{{ "{:,.0f}".format(cash_total) }}</div>
        <div class="card-detail">{{ cash_items|length }} 項目</div>
    </a>
    
    <a href="{{ url_for('manage_assets', asset_type='gold') }}" class="asset-card">
        <div class="card-icon" style="background: #fffde7;">🥇</div>
        <div class="card-name">金 (Gold)</div>
        <div class="card-amount">¥{{ "{:,.0f}".format(gold_total) }}</div>
        <div class="card-detail">{{ gold_items|length }} 項目</div>
        <div class="card-profit {% if gold_profit >= 0 %}profit-plus{% else %}profit-minus{% endif %}">
            {% if gold_profit >= 0 %}+{% endif %}¥{{ "{:,.0f}".format(gold_profit) }}
        </div>
    </a>
    
    <a href="{{ url_for('manage_assets', asset_type='crypto') }}" class="asset-card">
        <div class="card-icon" style="background: #f3e5f5;">₿</div>
        <div class="card-name">暗号資産</div>
        <div class="card-amount">¥{{ "{:,.0f}".format(crypto_total) }}</div>
        <div class="card-detail">{{ crypto_items|length }} 項目</div>
        <div class="card-profit {% if crypto_profit >= 0 %}profit-plus{% else %}profit-minus{% endif %}">
            {% if crypto_profit >= 0 %}+{% endif %}¥{{ "{:,.0f}".format(crypto_profit) }}
        </div>
    </a>
</div>
{% endblock %}